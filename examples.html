<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Examples &#8212; Data Snack  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="data_snack" href="modules.html" />
    <link rel="prev" title="Welcome to Data Snack’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h1>
<p>In this section we will go through a few examples of how <code class="docutils literal notranslate"><span class="pre">Snack</span></code> can be used to save and retrieve your entities from the database.</p>
<section id="example-1-creating-new-entities-and-saving">
<h2>Example 1 - Creating new entities and saving<a class="headerlink" href="#example-1-creating-new-entities-and-saving" title="Link to this heading">¶</a></h2>
<p>This is a basic example explaining how to define new, save and retrieve your entity using <code class="docutils literal notranslate"><span class="pre">Snack</span></code>.</p>
<section id="define-entities">
<h3>1. Define entities<a class="headerlink" href="#define-entities" title="Link to this heading">¶</a></h3>
<p>The first thing you need to do is to define an <code class="docutils literal notranslate"><span class="pre">Entity</span></code>. Entities are used to define a common structure of the objects stores in your database.
They provide a schema for fields and their types. The schema is used to validate the data whenever you are trying to save it.</p>
<p>We recommend adding additional layer of validation using <code class="docutils literal notranslate"><span class="pre">dataclass</span></code> type validation. For example through using <code class="docutils literal notranslate"><span class="pre">pydantic.dataclass</span></code> decorator.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydantic.dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Text</span>
<span class="kn">from</span> <span class="nn">data_snack.entities</span> <span class="kn">import</span> <span class="n">Entity</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Car</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
        <span class="n">index</span><span class="p">:</span> <span class="n">Text</span>
        <span class="n">price</span><span class="p">:</span> <span class="nb">int</span>
        <span class="n">brand</span><span class="p">:</span> <span class="n">Text</span>
</pre></div>
</div>
</section>
<section id="connect-to-redis">
<h3>2. Connect to redis<a class="headerlink" href="#connect-to-redis" title="Link to this heading">¶</a></h3>
<p>In these examples we are using <code class="docutils literal notranslate"><span class="pre">Redis</span></code> as a backend for our data. But you could easily adjust it to your needs as long as your client will follow
the interface defined by <code class="docutils literal notranslate"><span class="pre">data_snack.connection.Connection</span></code> class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">redis</span>
<span class="n">redis_connection</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span>
   <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
   <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span>
   <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-snack-instance">
<h3>3. Create snack instance<a class="headerlink" href="#create-snack-instance" title="Link to this heading">¶</a></h3>
<p>To start you need to create a <code class="docutils literal notranslate"><span class="pre">Snack</span></code> client using the connection created in the previous step. Then, you need to register all entities you will use.
While registering the entity you will also select which columns will be used as keys.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">data_snack</span> <span class="kn">import</span> <span class="n">Snack</span>
<span class="n">snack</span> <span class="o">=</span> <span class="n">Snack</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">redis_connection</span><span class="p">)</span>  <span class="c1"># create instance</span>
<span class="n">snack</span><span class="o">.</span><span class="n">register_entity</span><span class="p">(</span><span class="n">Car</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>  <span class="c1"># register your entity</span>
</pre></div>
</div>
</section>
<section id="save-and-load-single-entity">
<h3>4. Save and load single entity<a class="headerlink" href="#save-and-load-single-entity" title="Link to this heading">¶</a></h3>
<p>You can now use <code class="docutils literal notranslate"><span class="pre">Snack</span></code> to save and load your entities. Notice, that since the entity keys are defined as a list, when getting the entity you need to provide keys are a list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">snack</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Car</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">brand</span><span class="o">=</span><span class="s2">&quot;Audi&quot;</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">17000</span><span class="p">))</span>
<span class="c1"># &#39;Car-2&#39;</span>
<span class="n">snack</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Car</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">])</span>
<span class="c1"># Car(index=&#39;1&#39;, price=17000, brand=&#39;Audi&#39;)</span>
</pre></div>
</div>
</section>
<section id="save-and-load-multiple-entities">
<h3>5. Save and load multiple entities<a class="headerlink" href="#save-and-load-multiple-entities" title="Link to this heading">¶</a></h3>
<p>You can also use <cite>mset</cite> and <cite>mget</cite> to save and load multiple objects. This function is using an optimized way for handling multiple entities. So this way will be always faster than doing it manually using the standard <cite>get</cite> and <cite>set</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Car</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">brand</span><span class="o">=</span><span class="s2">&quot;Audi&quot;</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">17000</span><span class="p">),</span>
        <span class="n">Car</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="n">brand</span><span class="o">=</span><span class="s2">&quot;Opel&quot;</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">4000</span><span class="p">),</span>
        <span class="n">Car</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="n">brand</span><span class="o">=</span><span class="s2">&quot;Audi&quot;</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">7000</span><span class="p">),</span>
        <span class="n">Car</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="n">brand</span><span class="o">=</span><span class="s2">&quot;Toyota&quot;</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">14000</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">snack</span><span class="o">.</span><span class="n">set_many</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># [&#39;Car-1&#39;, &#39;Car-2&#39;, &#39;Car-3&#39;, &#39;Car-4&#39;]</span>
<span class="n">entities</span> <span class="o">=</span> <span class="n">snack</span><span class="o">.</span><span class="n">get_many</span><span class="p">(</span><span class="n">Car</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;1&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;3&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;4&quot;</span><span class="p">]])</span>
<span class="c1"># [Car(index=&#39;1&#39;, price=17000, brand=&#39;Audi&#39;), Car(index=&#39;2&#39;, price=4000, brand=&#39;Opel&#39;), Car(index=&#39;3&#39;, price=7000, brand=&#39;Audi&#39;)]</span>
</pre></div>
</div>
</section>
</section>
<section id="example-2-using-an-entitywrap">
<h2>Example 2 - Using an EntityWrap<a class="headerlink" href="#example-2-using-an-entitywrap" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">EntityWrap</span></code> are providing an easier interface for working with one selected type of entities.
This way you can access <code class="docutils literal notranslate"><span class="pre">Snack</span></code> without a need to specify the <code class="docutils literal notranslate"><span class="pre">EntityType</span></code> in each command.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">car_wrap</span> <span class="o">=</span> <span class="n">snack</span><span class="o">.</span><span class="n">create_wrap</span><span class="p">(</span><span class="n">Car</span><span class="p">)</span>
<span class="n">car_wrap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Car</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">brand</span><span class="o">=</span><span class="s2">&quot;Audi&quot;</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="mi">17000</span><span class="p">))</span>
<span class="c1"># &#39;Car-2&#39;</span>
<span class="n">car_wrap</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s2">&quot;1&quot;</span><span class="p">])</span>
<span class="c1"># Car(index=&#39;1&#39;, price=17000, brand=&#39;Audi&#39;)</span>
</pre></div>
</div>
</section>
<section id="example-3-using-data-frame-utils-functions">
<h2>Example 3 - Using data frame utils functions<a class="headerlink" href="#example-3-using-data-frame-utils-functions" title="Link to this heading">¶</a></h2>
<p>In this example we will go through <code class="docutils literal notranslate"><span class="pre">DataFrameWrap</span></code> that was created to make working with <code class="docutils literal notranslate"><span class="pre">pandas</span></code> data frames easier.</p>
<section id="define-your-dataset">
<h3>1. Define your dataset<a class="headerlink" href="#define-your-dataset" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
        <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;brand&quot;</span><span class="p">:</span> <span class="s2">&quot;Audi&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">17000</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;brand&quot;</span><span class="p">:</span> <span class="s2">&quot;Opel&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">4000</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;brand&quot;</span><span class="p">:</span> <span class="s2">&quot;Audi&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">7000</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;brand&quot;</span><span class="p">:</span> <span class="s2">&quot;Toyota&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">14000</span><span class="p">},</span>
<span class="p">])</span>
</pre></div>
</div>
</section>
<section id="save-and-load-you-data-frame">
<h3>2. Save and load you data frame<a class="headerlink" href="#save-and-load-you-data-frame" title="Link to this heading">¶</a></h3>
<p>You can save it by manually mapping the data frame into a list of python objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Car</span><span class="p">(</span><span class="o">**</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Or you can use a predefined helper function that will do that for you.
Function <code class="docutils literal notranslate"><span class="pre">set_dataframe</span></code> and <code class="docutils literal notranslate"><span class="pre">get_dataframe</span></code> provides an interface that allows you to save and load data frames object
that follows the schema defined by your entity.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_wrap</span> <span class="o">=</span> <span class="n">snack</span><span class="o">.</span><span class="n">create_wrap</span><span class="p">(</span><span class="n">Car</span><span class="p">,</span> <span class="n">DataFrameWrap</span><span class="p">)</span>

<span class="n">db_wrap</span><span class="o">.</span><span class="n">set_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># [&#39;Car-1&#39;, &#39;Car-2&#39;, &#39;Car-3&#39;, &#39;Car-4&#39;]</span>
<span class="n">db_wrap</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;index&#39;</span><span class="p">]])</span>
</pre></div>
</div>
<p>Notice, <code class="docutils literal notranslate"><span class="pre">get_dataframe</span></code> requires a data frame with columns defined as keys for given entity. As a result the function
will return all entities mapped into a data frame. It will not extend an input data frame,
but instead return a new one only with the fields defined by the selected <code class="docutils literal notranslate"><span class="pre">Entity</span></code>.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Data Snack</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-1-creating-new-entities-and-saving">Example 1 - Creating new entities and saving</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-2-using-an-entitywrap">Example 2 - Using an EntityWrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-3-using-data-frame-utils-functions">Example 3 - Using data frame utils functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">data_snack</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to Data Snack’s documentation!</a></li>
      <li>Next: <a href="modules.html" title="next chapter">data_snack</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022, WebInterpret.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/examples.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>